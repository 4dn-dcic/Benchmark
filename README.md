# pipelines-cwl
* This is a collection of pipelines built by 4DN-DCIC that were created and run either on the SevenBridges platform or on the 4DN platform, AWSEM.
* Starting from 0.0.5, the repo contains a benchmarking script for some of the CWLs, that returns total space, mem and CPUs required per given input size.

### Example usage of benchmarking script
```python
from Benchmark import Benchmark as B
B.md5({'input_size_in_bytes': {'input_file':20000}})
```
```
{'aws': {'mem': 4.0, 'recommended_instance_type': 't2.medium', 'cost': 0.047, 'EBS_optimized': False, 'EBS_optimization_surcharge': None, 'cpu': 2}, 'min_CPU': 1, 'total_mem_in_MB': 4, 'total_size_in_GB': 3.019073486328125}
```
```python
B.fastqc_0_11_4_1({'input_size_in_bytes': {'input_fastq':20000},'threads': 4})
```
```
{'aws': {'EBS_optimized': True, 'cpu': 128, 'cost': 13.338, 'recommended_instance_type': 'x1.32xlarge', 'EBS_optimization_surcharge': 0.0, 'mem': 1952.0}, 'total_size_in_GB': 3.03814697265625, 'min_CPU': 4, 'total_mem_in_MB': 1200}
```
```python
B.bwa_mem({'input_size_in_bytes': {'fastq1':93520, 'fastq2':97604, 'bwa_index':3364568}, 'nThreads': 4})
```
```
{'aws': {'cost': 100000}, 'total_size_in_GB': 14.855186462402344, 'min_CPU': 4, 'total_mem_in_MB': 13142.84375}
```

To use Benchmark in from other places, install it as below.
```
pip install git+git://github.com/4dn-dcic/pipelines-cwl.git
```


### Notes on SBG/AWSEM

#### Freeze >=0.0.2
* Directory `cwl_awsem` is manually updated starting from freeze 0.0.2 (after Sep 1, 2017), since we no longer use SevenBridges.

#### Freeze `0.0.1` 
* Freeze `0.0.1` contains exported SBG CWLs and AWSEM CWL files auto-converted from SBG CWLs. The following is a description of how freeze 0.0.1 was generated.

    The content has been generated by the following command.
    ```
    source download.sh 
    ```
    For this to work, you need to have SBG_TOKEN as an environmental variable on your machine.



    To convert sbg cwl to awsem cwl in a batch, do the following
    ```
    source convert.sh
    ```
    This conversion uses script `convert_sbgcwl_to_awsemcwl.py` individually.
    The shell script assumes Mac (`xargs -I{}` instead of `xargs -i`).


